#------------------------------------------------------------------------------------
# Description: the RNA-seq data processing pipeline for the maize dataset
# Data source:  SRA, PRJNA436356; GEO, GSE111250
# Paper reference: 10.1105/tpc.18.00153
# Author: Dae Kwan ko (dkko@msu.edu)
# Last modified: 08-30-2024
#------------------------------------------------------------------------------------

### merge 2 technical replicates into a single file
cat SRX3751703_1.fastq SRX3751727_1.fastq > 0h_1_R1.fastq

### count lines of raw files
wc -l ${myfile}.fastq > ${myfile}_total_lines.txt

### compress raw files
gzip ${INPUT}.fastq

### fastqc on raw files
fastqc -o ${OUTPUT} -f fastq ${INPUT}

### cutadapt
cutadapt -f fastq -q 20,20 -m 30 -a AGATCGGAAGAGCACACGTCTGAACTCCAGTCAC -A AGATCGGAAGAGCGTCGTGTAGGGAAAGAGTGTAGATCTCGGTGGTCGCCGTATCATT \
-o ${myfile}_R1_cutadapt.fastq \
-p ${myfile}_R2_cutadapt.fastq \
${myfile}_R1.fastq.gz ${myfile}_R2.fastq.gz

### count lines of cleaned files
wc -l ${myfile}.fastq > ${myfile}_total_lines.txt

### compress cleaned files
gzip ${INPUT}.fastq

### fastqc on cleaned files
fastqc -o ${OUTPUT} -f fastq ${INPUT}

### bowtie2 index for the maize genome
bowtie2-build -f B73_v4.chr.fa B73_v4.chr

### mapping to the genome
tophat2 -o /${OUTPUT} \
-I 30000 \
-i 10 \
-G /mnt/home/dkko/genomes/maize_v4/Zea_mays.B73_RefGen_v4.59.chr.gff3 \
--library-type fr-unstranded \
/mnt/home/dkko/genomes/maize_v4/B73_v4.chr \
${INPUT}_R1_cutadapt.fastq.gz \
${INPUT}_R2_cutadapt.fastq.gz

### sort accepted_hits.bam
samtools sort -o ${OUTPUT} ${INPUT}

### index accepted_hits.bam
samtools index ${INPUT}

### calculate fpkm with cufflinks
cufflinks -G /mnt/home/dkko/genomes/maize_v4/Zea_mays.B73_RefGen_v4.59.chr.gff3 \
-b /mnt/home/dkko/genomes/maize_v4/B73_v4.chr.fa \
--library-type fr-unstranded \
-q \
-I 30000 \
-o /mnt/home/dkko/project_maize/RNAseq_TPC/5_cutfflinks/${myfile}_cutfflinks \
/mnt/home/dkko/project_maize/RNAseq_TPC/4_tophat2_bowtie2/${myfile}/accepted_hits.bam

## read count with htseq-count
htseq-count --format=bam \
--idattr=ID \
--order=pos \
--stranded=no \
--minaqual=10 \
--mode=union \
--type=gene \
/mnt/home/dkko/project_maize/RNAseq_TPC/4_tophat2_bowtie2/${myfile}/${myfile}.accepted_hits.sorted.bam \
/mnt/home/dkko/genomes/maize_v4/Zea_mays.B73_RefGen_v4.59.chr.gff3 > /mnt/home/dkko/project_maize/RNAseq_TPC/6_htseq_count/${myfile}.htseq.txt


